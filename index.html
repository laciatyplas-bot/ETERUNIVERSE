<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ETERNIVERSE â€” Åšwiat I: PSYCHE / INTERSEEKER</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="favicon.ico">
</head>
<body>
  <header>
    <h1>ğŸŒŒ ETERNIVERSE â€” Åšwiat I: PSYCHE</h1>
    <p>System redakcyjny Kroniki Woli â€” Architekt: Maciej Maciuszek</p>
    <div class="header-buttons">
      <button id="addBookBtn">+ Dodaj ksiÄ…Å¼kÄ™</button>
      <button id="exportBtn">ğŸ’¾ Eksport JSON</button>
      <button id="openConsoleBtn">ğŸª Konsola Belle</button>
    </div>
  </header>

  <main id="app">
    <p class="loading">Åadowanie systemu ETERNIVERSE<span class="dots">...</span></p>
    <div id="error-message" style="display:none; color:#ff6b6b; text-align:center; padding:2rem;">
      <h2>BÅ‚Ä…d Å‚adowania</h2>
      <p>Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ silnika. SprawdÅº konsolÄ™ (F12) i upewnij siÄ™, Å¼e pliki JS w folderze js/ istniejÄ….</p>
    </div>
  </main>

  <!-- Belle avatar z bezpiecznym fallbackiem -->
  <div id="belle" class="belle-avatar">
    <img src="media/covers/default.jpg" 
         alt="Belle" 
         onerror="this.src='https://placehold.co/150x150/000/fff/png?text=Belle'; this.onerror=null;">
    <div id="belleSpeech">CzeÅ›Ä‡, Architekcie... Å‚adujÄ™ system...</div>
  </div>

  <!-- Modal edycji ksiÄ…Å¼ki -->
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <span class="close-modal" onclick="document.getElementById('modal').classList.add('hidden')">Ã—</span>
      <h2 id="modalTitle">Nowa ksiÄ…Å¼ka</h2>
      <label>Brama:</label>
      <select id="gateSelect"></select>
      <label>TytuÅ‚:</label>
      <input type="text" id="bookTitle" placeholder="TytuÅ‚ ksiÄ…Å¼ki">
      <label>Opis:</label>
      <textarea id="bookDesc" placeholder="Opis ksiÄ…Å¼ki..."></textarea>
      <label>OkÅ‚adka (link zewnÄ™trzny lub lokalny):</label>
      <input type="text" id="bookCover" placeholder="media/covers/... lub https://...">
      <label>Plik audio (link zewnÄ™trzny lub lokalny):</label>
      <input type="text" id="bookAudio" placeholder="media/audio/... lub https://...">
      <div class="modal-actions">
        <button id="cancelBtn" onclick="document.getElementById('modal').classList.add('hidden')">Anuluj</button>
        <button id="saveBtn">Zapisz</button>
      </div>
    </div>
  </div>

  <!-- Skrypty â€“ kolejnoÅ›Ä‡ krytyczna -->
  <script>
    // Bezpieczne Å‚adowanie skryptÃ³w â€“ tylko raz
    if (!window.enginesLoaded) {
      window.enginesLoaded = true;

      const ENGINES = [
        "js/world_psyche.js",
        "js/core.js",
        "js/book_editor.js",
        "js/eter_console.js"
        // Dodaj wiÄ™cej jeÅ›li potrzeba
      ];

      function loadEngine(i = 0) {
        if (i >= ENGINES.length) {
          console.log("âœ… Wszystkie silniki zaÅ‚adowane");
          if (typeof initEterniverse === "function") initEterniverse();
          const loading = document.querySelector('.loading');
          if (loading) loading.remove();
          return;
        }

        const src = ENGINES[i];
        if (document.querySelector(`script[src="${src}"]`)) {
          console.log(`Pomijam juÅ¼ zaÅ‚adowany: ${src}`);
          loadEngine(i + 1);
          return;
        }

        const s = document.createElement("script");
        s.src = src;
        s.onload = () => {
          console.log(`âš™ï¸ ZaÅ‚adowano: ${src}`);
          loadEngine(i + 1);
        };
        s.onerror = () => {
          console.error(`âŒ BÅ‚Ä…d Å‚adowania: ${src}`);
          if (!document.querySelector('#error-message').style.display) {
            document.querySelector('.loading').style.display = 'none';
            document.getElementById('error-message').style.display = 'block';
          }
          loadEngine(i + 1); // Kontynuuj mimo bÅ‚Ä™du
        };
        document.head.appendChild(s);
      }

      console.log("ğŸŒŒ Start Å‚adowania silnikÃ³w ETERNIVERSE...");
      loadEngine();
    }
  </script>
</body>
</html>
