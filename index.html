<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ETERNIVERSE – Mapa Światów | Master Edition</title>
  <meta name="description" content="Interaktywna mapa systemu ETERNIVERSE – bramy, serie i księgi w jednym widoku.">
  <style>
    /* Master CSS – Ultimate Professional Cosmic Interface (2026 Edition) */

    * { box-sizing:border-box; margin:0; padding:0; font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; }

    body { background:#05070a; color:#e6e6e6; min-height:100vh; display:flex; flex-direction:column; }

    header { background:rgba(17,24,39,0.94); padding:24px; border-bottom:1px solid #2d3748; backdrop-filter:blur(20px); box-shadow:0 12px 40px rgba(0,0,0,0.6); display:flex; flex-direction:column; gap:24px; align-items:center; }

    header h1 { font-size:32px; font-weight:800; color:#93c5fd; letter-spacing:2px; text-align:center; text-shadow:0 8px 32px rgba(147,197,253,0.4); }

    .controls { display:flex; flex-wrap:wrap; gap:16px; justify-content:center; width:100%; max-width:1200px; }

    .controls input, .controls select, .controls button { padding:14px 20px; border-radius:16px; border:none; background:#1e293b; color:#e6e6e6; font-size:16px; transition:all 0.4s ease; box-shadow:0 4px 16px rgba(0,0,0,0.3); }

    .controls input:focus, .controls select:focus { outline:none; box-shadow:0 0 0 4px rgba(96,165,250,0.4); }

    .controls button { background:#1e40af; cursor:pointer; font-weight:700; }

    .controls button:hover { background:#2563eb; transform:translateY(-4px); box-shadow:0 12px 32px rgba(37,99,235,0.4); }

    main { flex:1; display:flex; flex-direction:column; overflow:hidden; }

    .panel { background:#111827; padding:24px; overflow-y:auto; scrollbar-width:thin; scrollbar-color:#4a5568 #111827; border-bottom:1px solid #2d3748; }

    .panel:last-child { border-bottom:none; }

    .panel::-webkit-scrollbar { width:10px; }
    .panel::-webkit-scrollbar-track { background:#111827; }
    .panel::-webkit-scrollbar-thumb { background:#4a5568; border-radius:5px; }

    #worldList { max-height:40vh; }

    #worldList button { display:block; width:100%; padding:24px; margin-bottom:20px; background:linear-gradient(135deg,#0f2138,#071626); border:none; border-radius:24px; color:#E6F6F5; font-size:22px; font-weight:700; cursor:pointer; box-shadow:0 16px 60px rgba(0,0,0,0.7); transition:all 0.6s ease; text-align:left; position:relative; }

    #worldList button:hover { transform:translateY(-12px) scale(1.03); box-shadow:0 24px 80px rgba(0,0,0,0.9); }

    #contentArea { flex:1; padding:40px; }

    #contentArea h2 { font-size:42px; color:#D9A441; text-align:center; margin-bottom:40px; text-shadow:0 12px 40px rgba(217,164,65,0.5); }

    .gate { margin:64px 0; padding:56px; background:linear-gradient(145deg,#08121c,#0f2138); border-radius:32px; box-shadow:0 32px 100px rgba(0,0,0,0.9); position:relative; overflow:hidden; transition:all 0.7s ease; }

    .gate::before { content:''; position:absolute; top:0; left:0; width:100%; height:16px; background:var(--gate-color, #28D3C6); border-radius:32px 32px 0 0; }

    .gate h3 { font-size:36px; color:var(--gate-color, #28D3C6); margin-bottom:24px; text-align:center; text-shadow:0 0 50px var(--gate-color, #28D3C6)50; }

    .gate .sub { opacity:0.9; font-size:20px; margin-bottom:40px; text-align:center; line-height:1.7; }

    .gate .tag { display:block; text-align:center; margin-bottom:48px; font-size:20px; padding:16px 48px; background:linear-gradient(135deg,rgba(217,164,65,0.35),rgba(40,211,198,0.35)); color:#D9A441; border-radius:80px; letter-spacing:3px; font-weight:800; box-shadow:0 20px 60px rgba(217,164,65,0.5); }

    .books-header { display:flex; justify-content:space-between; align-items:center; margin:48px 0 24px; flex-wrap:wrap; gap:20px; }

    .books-header strong { font-size:24px; color:#E6F6F5; }

    .add-book-btn { padding:16px 36px; background:#1e40af; border:none; border-radius:20px; color:#fff; cursor:pointer; font-weight:700; font-size:18px; transition:all 0.4s ease; }

    .add-book-btn:hover { background:#2563eb; transform:translateY(-6px); box-shadow:0 16px 40px rgba(37,99,235,0.5); }

    .book { padding:32px; margin:32px 0; background:rgba(15,33,56,0.7); border-radius:28px; border:1px solid rgba(255,255,255,0.15); position:relative; transition:all 0.6s ease; }

    .book:hover { transform:translateX(24px) scale(1.04); box-shadow:0 32px 100px rgba(0,0,0,0.7); }

    .book strong { display:block; font-size:26px; color:#E6F6F5; margin-bottom:16px; }

    .book .status { display:inline-block; padding:12px 28px; background:rgba(217,164,65,0.5); color:#D9A441; border-radius:40px; font-size:16px; font-weight:800; }

    .book p { margin:24px 0 0; line-height:1.8; opacity:0.95; font-size:18px; }

    .book-actions { position:absolute; top:32px; right:32px; display:flex; gap:16px; opacity:0; transition:opacity 0.5s ease; flex-wrap:wrap; }

    .book:hover .book-actions { opacity:1; }

    .book-actions button { padding:12px 24px; border:none; border-radius:16px; color:#fff; cursor:pointer; font-size:15px; font-weight:700; }

    .edit-btn { background:#2563eb; }
    .delete-btn { background:#dc2626; }

    #log { background:#05070a; padding:24px; font-family:monospace; font-size:14px; line-height:1.6; white-space:pre-wrap; min-height:160px; border-top:1px solid #2d3748; }

    /* Responsywność – Master Edition */
    @media (min-width:1280px) {
      main { display:grid; grid-template-columns:340px 1fr 440px; }
      header { flex-direction:row; justify-content:space-between; align-items:center; }
      .controls { width:auto; gap:20px; }
      #worldList { max-height:none; }
    }

    @media (max-width:1279px) and (min-width:1024px) {
      main { grid-template-columns:300px 1fr 400px; }
    }

    @media (max-width:1023px) and (min-width:768px) {
      main { grid-template-columns:260px 1fr 340px; }
      header h1 { font-size:30px; }
    }

    @media (max-width:767px) {
      header { padding:20px; gap:24px; }
      header h1 { font-size:26px; }
      .controls { flex-direction:column; }
      .controls input, .controls select, .controls button { width:100%; }
      #contentArea { padding:24px; }
      #contentArea h2 { font-size:34px; }
      .gate { padding:40px; margin:48px 0; }
      .gate h3 { font-size:30px; }
      .book-actions { opacity:1; position:static; margin-top:32px; justify-content:center; }
      .book-actions button { width:100%; margin:12px 0; }
    }

    @media (max-width:480px) {
      header h1 { font-size:24px; }
      #contentArea h2 { font-size:30px; }
      .gate { padding:32px; margin:40px 0; }
      .gate h3 { font-size:28px; }
      .book { padding:24px; }
      .book strong { font-size:22px; }
      .add-book-btn { width:100%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>MAPA ETERNIVERSE</h1>
      <div class="subtitle">
        Centralny interfejs Architekta. Wszystkie bramy i księgi w czytelnym, responsywnym widoku.
      </div>

      <div class="toolbar">
        <div class="search">
          <input type="text" id="searchInput" placeholder="Szukaj tytułu, tagu, opisu...">
        </div>
        <select id="gateFilter">
          <option value="all">Wszystkie bramy</option>
        </select>
        <select id="statusFilter">
          <option value="all">Wszystkie statusy</option>
          <option value="published">Opublikowane</option>
          <option value="ready">Gotowe</option>
          <option value="writing">W trakcie pisania</option>
          <option value="draft">Szkic</option>
          <option value="idea">Idea</option>
        </select>
        <button class="main" id="addBookBtn">+ Dodaj księgi</button>
      </div>
    </header>

    <main>
      <section class="grid" id="gatesGrid">
        <!-- Karty bram będą renderowane dynamicznie -->
      </section>
    </main>
  </div>

  <!-- Modal dodawania/edycji księgi -->
  <div class="modal-backdrop" id="editModal">
    <div class="modal">
      <h2>Edytuj księgę</h2>
      <div class="modal-row">
        <label>Brama</label>
        <select id="modalGate"></select>
      </div>
      <div class="modal-row">
        <label>Tytuł</label>
        <input id="modalTitle" placeholder="np. InterSeeker – Atlas Wewnętrzny">
      </div>
      <div class="modal-row">
        <label>Status</label>
        <select id="modalStatus">
          <option value="idea">Idea</option>
          <option value="draft">Szkic</option>
          <option value="writing">W trakcie pisania</option>
          <option value="ready">Gotowe</option>
          <option value="published">Opublikowane</option>
        </select>
      </div>
      <div class="modal-row">
        <label>URL okładki (opcjonalne)</label>
        <input id="modalCover" placeholder="https://...">
      </div>
      <div class="modal-actions">
        <button id="modalCancel">Anuluj</button>
        <button class="primary" id="modalSave">Zapisz</button>
      </div>
    </div>
  </div>

  <!-- Podgląd okładki -->
  <div class="cover-preview" id="coverPreview">
    <span class="cover-preview-close" id="coverClose">×</span>
    <img id="coverImg" alt="Okładka księgi">
  </div>

  <script>
    // render.js – Czysty silnik renderowania bram i ksiąg

    function renderGates(data, container, filters = {}) {
      const { search = '', gateId = null, status = null } = filters;

      container.innerHTML = '';

      data.forEach(brama => {
        if (gateId !== null && brama.id !== gateId) return;

        const card = document.createElement('article');
        card.className = 'brama-card';

        card.innerHTML = `
          <div class="brama-header">
            <div>
              <div class="brama-title">${escapeHtml(brama.name)}</div>
              <div class="brama-sub">${escapeHtml(brama.sub)}</div>
            </div>
            <span class="badge">${escapeHtml(brama.tag)}</span>
          </div>
        `;

        const booksWrap = card.querySelector('.books');

        let visibleBooks = brama.books;

        // Filtr status
        if (status) {
          visibleBooks = visibleBooks.filter(book => book.status === status);
        }

        // Wyszukiwanie
        if (search) {
          visibleBooks = visibleBooks.filter(book =>
            book.title.toLowerCase().includes(search)
          );
        }

        if (visibleBooks.length === 0) {
          booksWrap.innerHTML = '<div class="no-books">Brak tytułów pasujących do filtrów.</div>';
        } else {
          visibleBooks.forEach((book, bookIndex) => {
            const bookEl = document.createElement('div');
            bookEl.className = 'book';

            const coverStyle = book.cover ? `background-image:url('${book.cover}')` : '';
            const coverText = book.cover ? '' : 'okładka';

            bookEl.innerHTML = `
              <div class="book-cover-thumb" style="\( {coverStyle}"> \){coverText}</div>
              <div class="book-main">
                <div class="book-title">${escapeHtml(book.title)}</div>
                <div class="book-meta">
                  <span>${escapeHtml(book.status || 'idea')}</span>
                  <span class="status \( {getStatusClass(book.status)}"> \){(book.status || 'idea').toUpperCase()}</span>
                </div>
              </div>
            `;

            // Podgląd okładki
            const thumb = bookEl.querySelector('.book-cover-thumb');
            if (book.cover) {
              thumb.addEventListener('click', (ev) => {
                ev.stopPropagation();
                coverImg.src = book.cover;
                coverPreview.style.display = 'flex';
              });
            }

            booksWrap.appendChild(bookEl);
          });
        }

        container.appendChild(card);
      });
    }

    // Bezpieczeństwo HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Klasa statusu
    function getStatusClass(status) {
      const map = {
        published: 'st-published',
        ready: 'st-ready',
        writing: 'st-writing',
        draft: 'st-draft',
        idea: 'st-idea'
      };
      return map[status] || 'st-idea';
    }
  </script>

  <script>
    // app.js – Główny silnik ETERNIVERSE Mapa (2026)

    const STORAGE_KEY = 'eterniverse_map_data';

    const DEFAULT_DATA = [
      {
        id: 1,
        name: "BRAMA I — INTERSEEKER",
        sub: "Psychika · Cień · Trauma · Archetyp",
        tag: "CORE / PSYCHE",
        color: "#28D3C6",
        books: [
          { title: "InterSeeker – Atlas Wewnętrzny", status: "published", cover: "" },
          { title: "ShadowSeeker – Anatomia Cienia", status: "ready", cover: "" },
          { title: "MemorySeeker – Archeologia Wspomnień", status: "draft", cover: "" }
        ]
      },
      {
        id: 2,
        name: "BRAMA II — CUSTOS / GENEZA",
        sub: "Strażnik · Rdzeń · Początek",
        tag: "CORE / ORIGIN",
        color: "#FF6B6B",
        books: [
          { title: "Geneza", status: "ready", cover: "" },
          { title: "Custos: Kodeks Głębi", status: "idea", cover: "" }
        ]
      },
      {
        id: 3,
        name: "BRAMA III — ETERSEEKER",
        sub: "Wola · Pole · Architektura",
        tag: "CORE / FIELD",
        color: "#D9A441",
        books: [
          { title: "EterSeeker – Księga Zakazana (Tom Zero)", status: "writing", cover: "" },
          { title: "EterSeeker – Architektura Woli", status: "idea", cover: "" }
        ]
      },
      {
        id: 4,
        name: "BRAMA IV — ARCHETYPY / WOLA",
        sub: "Konstrukcja · Role · Przeznaczenie",
        tag: "CORE / WILL",
        color: "#9B6BFF",
        books: [
          { title: "ArchetypSeeker – System Archetypów Eteru", status: "idea", cover: "" },
          { title: "Kronika Woli", status: "idea", cover: "" }
        ]
      },
      {
        id: 5,
        name: "BRAMA V — OBFITOSEEKER",
        sub: "Materia · Przepływ · Manifestacja",
        tag: "EMBODIED / FLOW",
        color: "#12C65B",
        books: [
          { title: "ObfitoSeeker – Kod Obfitości", status: "published", cover: "" },
          { title: "MateriaSeeker – Przewodnik Ciała i Przepływu", status: "draft", cover: "" }
        ]
      },
      {
        id: 6,
        name: "BRAMA VI — BIOSEEKER",
        sub: "Ciało · Biologia · Regulacja",
        tag: "EMBODIED / BIO",
        color: "#FFB14B",
        books: [
          { title: "BioSeeker – Sekret Biologii Pola", status: "idea", cover: "" }
        ]
      },
      {
        id: 7,
        name: "BRAMA VII — SPLĄTANIE / AI",
        sub: "Obserwator · Meta-tożsamość · Technologia",
        tag: "META / TECH",
        color: "#5DADE2",
        books: [
          { title: "SplatanieSeeker – Protokół Obserwatora", status: "idea", cover: "" },
          { title: "InterfejsSeeker – Interfejs Świadomości", status: "idea", cover: "" }
        ]
      },
      {
        id: 8,
        name: "BRAMA VIII — TRAJEKTORIE",
        sub: "Kod Życia · Linie Czasu · Fizyka Duszy",
        tag: "META / PHYSICS",
        color: "#FF9FF3",
        books: [
          { title: "TrajektoriaSeeker – Mapa Linii Życia", status: "ready", cover: "" },
          { title: "QuantumSeeker – Fizyka Duszy", status: "idea", cover: "" }
        ]
      },
      {
        id: 9,
        name: "BRAMA IX — ETERNIONY / KOLEKTYW",
        sub: "Węzły Pola · Wspólnota · Misja",
        tag: "COLLECTIVE",
        color: "#667eea",
        books: [
          { title: "Eteriony – Tom I", status: "idea", cover: "" },
          { title: "Eteriony – Tom II", status: "idea", cover: "" }
        ]
      },
      {
        id: 10,
        name: "BRAMA X — ETERUNIVERSE",
        sub: "Integracja · Jedność · Architekt",
        tag: "INTEGRATION",
        color: "#D9A441",
        books: [
          { title: "Architekt Eteru — Manifest Twórcy", status: "writing", cover: "" },
          { title: "Mapa Uniwersum Eteru", status: "idea", cover: "" }
        ]
      }
    ];

    let DATA = JSON.parse(localStorage.getItem(STORAGE_KEY)) || DEFAULT_DATA;

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA));
    }

    // ... (kod jak wcześniej, z dodaną funkcją openEditModal w modalSave.onclick)
  </script>
</body>
</html>