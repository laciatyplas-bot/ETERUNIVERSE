<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eterniverse Master Premium v4.0</title>
  <meta name="description" content="Profesjonalny asystent pisarski z AI, mapƒÖ uniwersum i eksportem DOCX">
  
  <!-- DOCX Library -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.min.js"></script>
  
  <style>
    :root {
      --bg-primary: #0d0d1a;
      --bg-secondary: #1a1a2e;
      --bg-panel: #16213e;
      --accent: #00d4ff;
      --accent-glow: #00ffff44;
      --gold: #f0b90b;
      --cyan: #00e0ff;
      --text: #e6f6ff;
      --text-muted: #88a0c0;
      --border: #334466;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
      --shadow-glow: 0 0 20px rgba(0, 212, 255, 0.3);
    }

    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@300;400;500&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: var(--text);
      height: 100vh;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      overflow: hidden;
      animation: fadeIn 1.2s ease-out;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes glowPulse { 0%, 100% { box-shadow: var(--shadow); } 50% { box-shadow: var(--shadow-glow); } }

    header {
      background: linear-gradient(90deg, rgba(13,13,26,0.95), rgba(26,26,46,0.95));
      backdrop-filter: blur(20px);
      padding: 2rem;
      text-align: center;
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow);
    }

    header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      background: linear-gradient(90deg, var(--cyan), var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
    }

    header p {
      font-size: 1.1rem;
      margin-top: 0.5rem;
      color: var(--text-muted);
      font-weight: 300;
    }

    .controls {
      padding: 1.5rem 2rem;
      background: rgba(22,33,62,0.8);
      backdrop-filter: blur(15px);
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }

    button, select {
      padding: 0.9rem 1.8rem;
      background: rgba(40,60,100,0.6);
      border: 1px solid var(--border);
      border-radius: 16px;
      color: var(--text);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.4s ease;
      backdrop-filter: blur(10px);
    }

    button:hover, select:hover {
      background: var(--accent-glow);
      border-color: var(--accent);
      transform: translateY(-4px);
      box-shadow: var(--shadow-glow);
      animation: glowPulse 2s infinite;
    }

    button.premium {
      background: linear-gradient(45deg, var(--gold), #f79c00);
      color: #000;
      font-weight: 600;
      border: none;
    }

    .main {
      display: grid;
      grid-template-columns: 360px 1fr 400px;
      gap: 2rem;
      padding: 2rem;
      overflow: hidden;
    }

    .panel {
      background: rgba(22,33,62,0.6);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid var(--border);
      padding: 1.8rem;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .panel h2 {
      font-family: 'Orbitron', sans-serif;
      color: var(--cyan);
      margin-bottom: 1.2rem;
      font-size: 1.5rem;
      text-shadow: 0 0 10px rgba(0, 224, 255, 0.4);
    }

    #book-title {
      width: 100%;
      padding: 1.2rem;
      font-size: 1.8rem;
      background: transparent;
      border: none;
      border-bottom: 3px solid var(--gold);
      color: var(--gold);
      font-weight: 500;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    #book-title:focus {
      outline: none;
      border-color: var(--accent);
    }

    textarea {
      flex: 1;
      background: rgba(10,15,30,0.7);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.8rem;
      color: var(--text);
      font-size: 1.1rem;
      line-height: 1.7;
      resize: none;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--accent-glow);
    }

    .book-card, .brama-card {
      padding: 1.2rem;
      margin-bottom: 1rem;
      background: rgba(255,255,255,0.05);
      border-radius: 14px;
      border-left: 4px solid var(--border);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .book-card:hover, .brama-card:hover {
      transform: translateX(12px);
      background: rgba(0,212,255,0.1);
      border-left-color: var(--cyan);
      box-shadow: var(--shadow-glow);
    }

    .active {
      border-left-color: var(--gold) !important;
      background: rgba(240,185,11,0.15) !important;
      box-shadow: var(--shadow-glow);
    }

    .suggestion {
      padding: 1.2rem;
      margin-bottom: 1rem;
      background: rgba(0,212,255,0.08);
      border-left: 5px solid var(--accent);
      border-radius: 12px;
      font-size: 1rem;
      opacity: 0.95;
    }

    .status {
      padding: 1.5rem;
      background: rgba(13,13,26,0.9);
      backdrop-filter: blur(20px);
      text-align: center;
      font-weight: 500;
      border-top: 1px solid var(--border);
      box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
    }

    @media (max-width: 1200px) {
      .main { grid-template-columns: 1fr; grid-template-rows: auto auto 1fr; }
      .panel { min-height: 300px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>ETERNIVERSE</h1>
    <p>Master Premium Suite v4.0 ‚Äî Tw√≥j portal do niesko≈Ñczonych ≈õwiat√≥w</p>
  </header>

  <div class="controls">
    <select id="profile-select">
      <option value="wattpad">üìñ Wattpad Mode</option>
      <option value="amazon">üõí Amazon Mode</option>
    </select>
    <button id="add-book-btn" class="premium">‚ú® Nowa Ksiƒôga</button>
    <button id="bella-analyze">üí° Bella AI</button>
    <button id="export-docx" class="premium">üì§ Eksport DOCX</button>
    <button id="start-dictate">üéôÔ∏è Dyktuj</button>
    <button id="stop-dictate" disabled>‚èπÔ∏è Stop</button>
  </div>

  <div class="main">
    <!-- Lewy panel: Ksiƒôgi + Mapa Bram -->
    <div class="panel">
      <h2>üìö Twoje Ksiƒôgi</h2>
      <div id="books-list"></div>

      <h2 style="margin-top: 2.5rem;">üåå Mapa Bram Eteruniverse</h2>
      <div id="mapa-grid"></div>
    </div>

    <!-- ≈örodek: Edytor -->
    <div class="panel">
      <input type="text" id="book-title" placeholder="Tytu≈Ç Twojej eternicznej opowie≈õci...">
      <textarea id="book-content" placeholder="Tu rodzƒÖ siƒô ≈õwiaty... Pisz, dyktuj, tw√≥rz. Bella czuwa."></textarea>
    </div>

    <!-- Prawy panel: Bella AI -->
    <div class="panel">
      <h2>üí° Bella Premium AI</h2>
      <div id="suggestions">
        <p style="opacity: 0.7; text-align: center; padding: 2rem;">
          ‚ú® Bella analizuje Tw√≥j tekst w czasie rzeczywistym...<br>
          Wybierz ksiƒôgƒô i kliknij "Bella AI"
        </p>
      </div>
    </div>
  </div>

  <div class="status" id="status">üåå Eterniverse Master Premium uruchomiony ‚Äì gotowy do kreacji</div>

  <script>
    'use strict';

    // Wbudowana mapa Eteruniverse
    const ETERUNIVERSE_MAPA = {
      worlds: [{
        name: "ETERUNIVERSE",
        gates: [
          { id: 1, name: "BRAMA 1 ‚Äî INTERSEEKER", books: ["INTERSEEKER: Geneza", "INTERSEEKER: Efekt Cienia"] },
          { id: 2, name: "BRAMA 2 ‚Äî ETERSEEKER", books: ["EterSeeker: Kronika Woli", "Interfejs ≈öwiadomo≈õci"] },
          { id: 3, name: "BRAMA 3 ‚Äî OBFITOSEEKER", books: ["ObfitoSeeker ‚Äì Kod Obfito≈õci"] },
          { id: 4, name: "BRAMA 4 ‚Äî THE KNOT", books: ["Kronika SplƒÖtania", "Eterniony Tom I"] },
          { id: 5, name: "BRAMA 5 ‚Äî RELIGIOSEEKER", books: ["ReligioSeeker"] }
        ]
      }]
    };

    class EterniversePremium {
      constructor() {
        this.BOOKS_KEY = 'eterniverse_premium_books';
        this.books = JSON.parse(localStorage.getItem(this.BOOKS_KEY) || '[]');
        this.currentBook = null;
        this.currentProfile = 'wattpad';
        this.recognition = null;

        this.init();
      }

      init() {
        this.bindEvents();
        this.renderAll();
        this.initSpeech();
        this.speak('Witaj w Eterniverse Master Premium. Tw√≥j portal do niesko≈Ñczono≈õci jest otwarty.');
      }

      bindEvents() {
        document.getElementById('profile-select').onchange = e => this.currentProfile = e.target.value;
        document.getElementById('add-book-btn').onclick = () => this.addBook();
        document.getElementById('bella-analyze').onclick = () => this.bellaAnalyze();
        document.getElementById('export-docx').onclick = () => this.exportDocx();
        document.getElementById('start-dictate').onclick = () => this.startDictation();
        document.getElementById('stop-dictate').onclick = () => this.stopDictation();
        document.getElementById('book-title').oninput = () => this.autoSave();
        document.getElementById('book-content').oninput = () => this.autoSave();
      }

      renderAll() {
        this.renderBooks();
        this.renderMapa();
        this.renderSuggestions([]);
      }

      renderBooks() {
        const list = document.getElementById('books-list');
        list.innerHTML = this.books.length ? this.books.map(book => `
          <div class="book-card \( {this.currentBook?.id === book.id ? 'active' : ''}" onclick="premium.openBook( \){book.id})">
            <strong>üìñ ${this.escape(book.title || 'Bez tytu≈Çu')}</strong>
            <div style="font-size:0.9rem;margin-top:0.5rem;opacity:0.8;">
              ${this.wordCount(book.content)} s≈Ç√≥w ‚Ä¢ ${new Date(book.created || Date.now()).toLocaleDateString('pl-PL')}
            </div>
          </div>
        `).join('') : '<p style="text-align:center;opacity:0.6;padding:3rem;">Kliknij "Nowa Ksiƒôga", by rozpoczƒÖƒá podr√≥≈º</p>';
      }

      renderMapa() {
        const grid = document.getElementById('mapa-grid');
        const gates = ETERUNIVERSE_MAPA.worlds[0].gates;
        grid.innerHTML = gates.map(gate => `
          <div class="brama-card" onclick="premium.insertBrama('${this.escape(gate.name)}')">
            <strong>${gate.name}</strong>
            <div style="font-size:0.9rem;margin-top:0.5rem;opacity:0.8;">${gate.books.length} tytu≈Ç√≥w</div>
          </div>
        `).join('');
      }

      insertBrama(name) {
        if (!this.currentBook) return this.status('Otw√≥rz lub utw√≥rz ksiƒôgƒô');
        const gate = ETERUNIVERSE_MAPA.worlds[0].gates.find(g => g.name === name);
        const list = gate.books.map(t => `üìñ ${t}`).join('\n');
        document.getElementById('book-content').value += `\n\n‚ú¶ === \( {name} === ‚ú¶\n \){list}\n\n`;
        this.autoSave();
        this.status(`Wstawiono bramƒô: ${name}`);
      }

      addBook() {
        const book = {
          id: Date.now(),
          title: 'Nowa Ksiƒôga Eteryczna',
          content: '',
          created: new Date().toISOString()
        };
        this.books.unshift(book);
        this.saveBooks();
        this.openBook(book.id);
        this.status('Nowa ksiƒôga stworzona');
      }

      openBook(id) {
        this.currentBook = this.books.find(b => b.id === id);
        document.getElementById('book-title').value = this.currentBook.title;
        document.getElementById('book-content').value = this.currentBook.content;
        this.renderBooks();
        this.speak(`Otworzono ksiƒôgƒô: ${this.currentBook.title}`);
      }

      autoSave() {
        if (!this.currentBook) return;
        this.currentBook.title = document.getElementById('book-title').value;
        this.currentBook.content = document.getElementById('book-content').value;
        this.saveBooks();
      }

      saveBooks() {
        localStorage.setItem(this.BOOKS_KEY, JSON.stringify(this.books));
      }

      bellaAnalyze() {
        if (!this.currentBook?.content) return this.status('Brak tekstu do analizy');
        const suggestions = this.generatePremiumSuggestions(this.currentBook.content);
        this.renderSuggestions(suggestions);
        this.speak(`${suggestions.length} sugestii premium od Bella`);
      }

      generatePremiumSuggestions(text) {
        const sugs = [];
        const words = text.toLowerCase().match(/\b\w+\b/g) || [];
        const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);

        if (this.currentProfile === 'amazon') {
          if (!/darmow|wysy≈Çk|gwaranc|saty/i.test(text)) sugs.push('üì¶ Dodaj mocne frazy: "darmowa wysy≈Çka", "gwarancja satysfakcji"');
          if (words.filter(w => /najlepszy|rewolucyjny|premium|ekskluzywny/i.test(w)).length < 3) sugs.push('üèÜ U≈ºyj s≈Ç√≥w premium: rewolucyjny, ekskluzywny, najwy≈ºsza jako≈õƒá');
        } else {
          const emotions = words.filter(w => /mi≈Ço≈õƒá|strach|rado≈õƒá|smutek|zakocha|przera≈º|nadzieja|gniew/i.test(w)).length;
          if (emotions < 5) sugs.push('‚ù§Ô∏è Wpleƒá g≈Çƒôbokie emocje ‚Äì czytelnik musi czuƒá ka≈ºde s≈Çowo');
          if (!text.includes('‚Äû') && !text.includes('"')) sugs.push('üí¨ Dialogi to serce Wattpad ‚Äì dodaj rozmowy postaci');
        }

        if (this.wordCount(text) < 300) sugs.push('üìà Rozwi≈Ñ tekst ‚Äì d≈Çu≈ºsze rozdzia≈Çy majƒÖ wiƒôkszy zasiƒôg');
        if (sentences.length < 10) sugs.push('‚ú® Wiƒôcej akapit√≥w ‚Äì lepsza dynamika i czytelno≈õƒá');

        return sugs.slice(0, 8);
      }

      renderSuggestions(sugs) {
        const panel = document.getElementById('suggestions');
        if (sugs.length === 0) {
          panel.innerHTML = '<p style="text-align:center;padding:2rem;opacity:0.8;">üéâ Perfekcja! Tekst nie wymaga sugestii.</p>';
          return;
        }
        panel.innerHTML = sugs.map(s => `<div class="suggestion">${s}</div>`).join('');
      }

      async exportDocx() {
        if (!this.currentBook) return this.status('Brak tre≈õci');
        const { Document, Packer, Paragraph, HeadingLevel } = docx;
        const doc = new Document({
          sections: [{
            children: [
              new Paragraph({ text: this.currentBook.title, heading: HeadingLevel.TITLE, alignment: "center" }),
              new Paragraph({ text: "Eterniverse Master Premium ‚Ä¢ " + new Date().toLocaleDateString('pl-PL'), alignment: "center" }),
              new Paragraph({ text: this.currentBook.content, spacing: { after: 200 } })
            ]
          }]
        });

        const blob = await Packer.toBlob(doc);
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${this.currentBook.title.replace(/[^a-z0-9]/gi, '_')}_Eterniverse_Premium.docx`;
        a.click();
        URL.revokeObjectURL(url);
        this.status('üìÑ Eksport Premium DOCX zako≈Ñczony');
      }

      initSpeech() {
        if (!('webkitSpeechRecognition' in window)) return;
        this.recognition = new (window.webkitSpeechRecognition || window.SpeechRecognition)();
        this.recognition.lang = 'pl-PL';
        this.recognition.continuous = true;
        this.recognition.interimResults = true;

        this.recognition.onresult = e => {
          const text = Array.from(e.results).map(r => r[0].transcript).join('');
          document.getElementById('book-content').value += text;
          this.autoSave();
        };

        this.recognition.onstart = () => {
          document.getElementById('start-dictate').disabled = true;
          document.getElementById('stop-dictate').disabled = false;
          this.status('üéôÔ∏è Dyktowanie aktywne');
        };

        this.recognition.onend = () => {
          document.getElementById('start-dictate').disabled = false;
          document.getElementById('stop-dictate').disabled = true;
        };
      }

      startDictation() { this.recognition?.start(); }
      stopDictation() { this.recognition?.stop(); }

      speak(text) {
        if ('speechSynthesis' in window) {
          const u = new SpeechSynthesisUtterance(text);
          u.lang = 'pl-PL';
          u.rate = 1.05;
          speechSynthesis.speak(u);
        }
      }

      status(msg) {
        document.getElementById('status').textContent = msg;
      }

      wordCount(text = '') { return (text.match(/\b\w+\b/g) || []).length; }
      escape(text) { return text.replace(/</g, '&lt;').replace(/>/g, '&gt;'); }
    }

    const premium = new EterniversePremium();
    window.premium = premium;
  </script>
</body>
</html>