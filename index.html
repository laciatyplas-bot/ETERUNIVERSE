<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ETERNIVERSE ‚Äî Wydawnictwo</title>

<style>
:root{
  --bg:#0b0f14;
  --panel:#121826;
  --card:#182033;
  --text:#e8f1ff;
  --accent:#5eead4;
  --gold:#f5c97a;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,Arial;
  background:var(--bg);
  color:var(--text);
  display:grid;
  grid-template-columns:320px 1fr;
  height:100vh;
}
aside{
  background:#0e1422;
  padding:15px;
  overflow:auto;
  border-right:1px solid #1f2937;
}
main{
  display:flex;
  flex-direction:column;
  height:100vh;
}
h1,h2,h3{margin:0 0 10px 0}
button{
  background:#1f2937;
  border:1px solid #374151;
  color:var(--text);
  padding:6px 10px;
  cursor:pointer;
}
button:hover{background:#374151}
input,select,textarea{
  width:100%;
  background:#0f172a;
  border:1px solid #334155;
  color:var(--text);
  padding:6px;
}
.world, .book{
  background:var(--card);
  padding:10px;
  margin-bottom:8px;
  cursor:pointer;
  border:1px solid #334155;
}
.world:hover,.book:hover{background:#1f2937}
.active{outline:2px solid var(--accent)}
.editor{
  display:grid;
  grid-template-columns:1fr 300px;
  height:100%;
}
textarea{
  height:100%;
  resize:none;
}
.panel{
  background:var(--panel);
  padding:10px;
  border-left:1px solid #1f2937;
}
.status{
  font-size:12px;
  opacity:.7;
}
</style>
</head>

<body>

<aside>
  <h2>üåå ≈öWIATY</h2>
  <div id="worlds"></div>

  <hr>
  <input id="newWorldName" placeholder="Nowy ≈õwiat">
  <button onclick="addWorld()">‚ûï Dodaj ≈õwiat</button>
</aside>

<main>
  <header style="padding:10px;border-bottom:1px solid #1f2937">
    <h1 id="currentTitle">ETERNIVERSE</h1>
    <div class="status" id="currentStatus"></div>
  </header>

  <div class="editor">
    <textarea id="editor" placeholder="Pisz tutaj‚Ä¶"></textarea>

    <div class="panel">
      <h3>üìò KsiƒÖ≈ºka</h3>
      <input id="bookTitle" placeholder="Tytu≈Ç ksiƒÖ≈ºki">
      <input id="bookCover" placeholder="URL ok≈Çadki">
      <select id="bookStatus">
        <option>idea</option>
        <option>writing</option>
        <option>ready</option>
        <option>published</option>
      </select>

      <hr>

      <h3>‚úçÔ∏è Profil</h3>
      <select id="profile">
        <option value="wattpad">Wattpad</option>
        <option value="amazon">Amazon</option>
      </select>

      <button onclick="saveBook()">üíæ Zapisz</button>
      <button onclick="exportDoc()">üìÑ Eksport DOCX</button>
    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/docx@7.3.0/build/index.min.js"></script>
<script>
const STORAGE="ETERNIVERSE_MASTER";
let data=JSON.parse(localStorage.getItem(STORAGE)||"[]");
let currentWorld=null,currentBook=null;

function save(){
  localStorage.setItem(STORAGE,JSON.stringify(data));
}

function render(){
  const w=document.getElementById("worlds");
  w.innerHTML="";
  data.forEach((world,wi)=>{
    const d=document.createElement("div");
    d.className="world"+(currentWorld===world?" active":"");
    d.textContent=world.name;
    d.onclick=()=>{currentWorld=world;currentBook=null;render()};
    w.appendChild(d);
    if(currentWorld===world){
      world.books.forEach(book=>{
        const b=document.createElement("div");
        b.className="book"+(currentBook===book?" active":"");
        b.textContent="‚Äì "+book.title;
        b.onclick=()=>{currentBook=book;loadBook();render()};
        w.appendChild(b);
      });
      const add=document.createElement("button");
      add.textContent="+ Dodaj ksiƒÖ≈ºkƒô";
      add.onclick=()=>{world.books.push({title:"Nowa ksiƒÖ≈ºka",text:"",status:"idea"});save();render()};
      w.appendChild(add);
    }
  });
}

function addWorld(){
  const n=document.getElementById("newWorldName").value.trim();
  if(!n)return;
  data.push({name:n,books:[]});
  save();render();
}

function loadBook(){
  if(!currentBook)return;
  editor.value=currentBook.text||"";
  bookTitle.value=currentBook.title;
  bookStatus.value=currentBook.status||"idea";
  currentTitle.textContent=currentBook.title;
}

function saveBook(){
  if(!currentBook)return;
  currentBook.title=bookTitle.value;
  currentBook.status=bookStatus.value;
  currentBook.text=editor.value;
  save();render();
}

async function exportDoc(){
  if(!currentBook)return;
  const {Document,Packer,Paragraph}=docx;
  const doc=new Document({
    sections:[{children:[new Paragraph(currentBook.title),new Paragraph(currentBook.text)]}]
  });
  const blob=await Packer.toBlob(doc);
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=currentBook.title.replace(/\s+/g,"_")+".docx";
  a.click();
}

render();
</script>
</body>
</html>