<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eterniverse Master Premium v5.0</title>
  <meta name="description" content="Profesjonalny asystent pisarski z mapƒÖ uniwersum, Bella AI i eksportem DOCX">
  
  <!-- DOCX Export -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.min.js"></script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@500&display=swap');

    :root {
      --bg-main: #0a0a0f;
      --bg-panel: #111118;
      --border: #2a2a38;
      --accent: #00c8ff;
      --gold: #e8b923;
      --text: #f0f0f5;
      --text-muted: #a0a0c0;
      --shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-main);
      color: var(--text);
      height: 100vh;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      overflow: hidden;
    }

    header {
      padding: 2rem;
      text-align: center;
      background: rgba(17,17,24,0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.8rem;
      color: var(--accent);
      letter-spacing: 2px;
    }

    header p {
      margin-top: 0.5rem;
      color: var(--text-muted);
      font-weight: 300;
    }

    .controls {
      padding: 1rem 2rem;
      background: rgba(17,17,24,0.8);
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }

    button, select {
      padding: 0.8rem 1.6rem;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover, select:hover {
      background: rgba(0,200,255,0.15);
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    button.primary {
      background: var(--accent);
      color: #000;
      font-weight: 600;
      border: none;
    }

    button.gold {
      background: var(--gold);
      color: #000;
      font-weight: 600;
      border: none;
    }

    .main {
      display: grid;
      grid-template-columns: 340px 1fr 380px;
      gap: 1.8rem;
      padding: 2rem;
      overflow: hidden;
    }

    .panel {
      background: var(--bg-panel);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 1.8rem;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow);
    }

    .panel h2 {
      font-size: 1.4rem;
      color: var(--accent);
      margin-bottom: 1.2rem;
      font-weight: 600;
    }

    #book-title {
      width: 100%;
      padding: 1rem;
      font-size: 2rem;
      background: transparent;
      border: none;
      border-bottom: 2px solid var(--gold);
      color: var(--gold);
      text-align: center;
      margin-bottom: 1.5rem;
      font-weight: 600;
    }

    #book-title:focus {
      outline: none;
      border-color: var(--accent);
    }

    textarea {
      flex: 1;
      background: rgba(15,15,25,0.8);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.6rem;
      color: var(--text);
      font-size: 1.1rem;
      line-height: 1.8;
      resize: none;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(15,15,25,1);
    }

    .book-card, .brama-card {
      padding: 1rem 1.2rem;
      margin-bottom: 1rem;
      background: rgba(255,255,255,0.04);
      border-radius: 10px;
      border-left: 3px solid var(--border);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .book-card:hover, .brama-card:hover {
      background: rgba(0,200,255,0.1);
      border-left-color: var(--accent);
      transform: translateX(6px);
    }

    .active {
      border-left-color: var(--gold);
      background: rgba(232,185,35,0.1);
    }

    .suggestion {
      padding: 1.2rem;
      margin-bottom: 1rem;
      background: rgba(0,200,255,0.08);
      border-left: 4px solid var(--accent);
      border-radius: 10px;
      font-size: 1rem;
      line-height: 1.5;
    }

    .status {
      padding: 1.2rem;
      text-align: center;
      background: rgba(17,17,24,0.9);
      backdrop-filter: blur(12px);
      font-size: 1rem;
      color: var(--text-muted);
      border-top: 1px solid var(--border);
    }

    @media (max-width: 1200px) {
      .main {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto 1fr;
      }
      .panel { min-height: 320px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>ETERNIVERSE</h1>
    <p>Master Premium v5.0 ‚Äî Czysty portal do kreacji literackiej</p>
  </header>

  <div class="controls">
    <select id="profile-select">
      <option value="wattpad">üìñ Tryb Wattpad</option>
      <option value="amazon">üõí Tryb Amazon</option>
    </select>
    <button id="add-book-btn" class="gold">+ Nowa Ksiƒôga</button>
    <button id="bella-analyze" class="primary">Bella AI</button>
    <button id="export-docx" class="gold">Eksport DOCX</button>
    <button id="start-dictate">Dyktuj</button>
    <button id="stop-dictate" disabled>Stop</button>
  </div>

  <div class="main">
    <!-- Lewy panel: Ksiƒôgi i Mapa -->
    <div class="panel">
      <h2>Twoje Ksiƒôgi</h2>
      <div id="books-list"></div>

      <h2 style="margin-top: 2rem;">Mapa Bram</h2>
      <div id="mapa-grid"></div>
    </div>

    <!-- Edytor g≈Ç√≥wny -->
    <div class="panel">
      <input type="text" id="book-title" placeholder="Tytu≈Ç ksiƒôgi...">
      <textarea id="book-content" placeholder="Tu powstaje Twoja historia..."></textarea>
    </div>

    <!-- Prawy panel: Bella AI -->
    <div class="panel">
      <h2>Bella AI</h2>
      <div id="suggestions">
        <p style="text-align:center; opacity:0.7; padding:2rem 0;">
          Kliknij ‚ÄûBella AI‚Äù, by otrzymaƒá sugestie redakcyjne
        </p>
      </div>
    </div>
  </div>

  <div class="status" id="status">Eterniverse gotowy ‚Äî zacznij pisaƒá</div>

  <script>
    'use strict';

    const MAPA = {
      gates: [
        { name: "BRAMA 1 ‚Äî INTERSEEKER", books: ["INTERSEEKER: Geneza", "INTERSEEKER: Efekt Cienia"] },
        { name: "BRAMA 2 ‚Äî ETERSEEKER", books: ["EterSeeker: Kronika Woli", "Interfejs ≈öwiadomo≈õci"] },
        { name: "BRAMA 3 ‚Äî OBFITOSEEKER", books: ["ObfitoSeeker ‚Äì Kod Obfito≈õci"] },
        { name: "BRAMA 4 ‚Äî THE KNOT", books: ["Kronika SplƒÖtania", "Eterniony Tom I"] },
        { name: "BRAMA 5 ‚Äî RELIGIOSEEKER", books: ["ReligioSeeker"] }
      ]
    };

    class Eterniverse {
      constructor() {
        this.BOOKS_KEY = 'eterniverse_v5_books';
        this.books = JSON.parse(localStorage.getItem(this.BOOKS_KEY) || '[]');
        this.currentBook = null;
        this.profile = 'wattpad';
        this.recognition = null;
        this.init();
      }

      init() {
        this.bindEvents();
        this.renderAll();
        this.initSpeech();
      }

      bindEvents() {
        document.getElementById('profile-select').onchange = e => this.profile = e.target.value;
        document.getElementById('add-book-btn').onclick = () => this.addBook();
        document.getElementById('bella-analyze').onclick = () => this.analyze();
        document.getElementById('export-docx').onclick = () => this.export();
        document.getElementById('start-dictate').onclick = () => this.startDictation();
        document.getElementById('stop-dictate').onclick = () => this.stopDictation();
        document.getElementById('book-title').oninput = () => this.save();
        document.getElementById('book-content').oninput = () => this.save();
      }

      renderAll() {
        this.renderBooks();
        this.renderMapa();
        this.renderSuggestions([]);
      }

      renderBooks() {
        const list = document.getElementById('books-list');
        if (this.books.length === 0) {
          list.innerHTML = '<p style="text-align:center;opacity:0.6;padding:2rem;">Brak ksiƒÖg ‚Äî utw√≥rz pierwszƒÖ</p>';
          return;
        }
        list.innerHTML = this.books.map(book => `
          <div class="book-card \( {this.currentBook?.id === book.id ? 'active' : ''}" onclick="app.open( \){book.id})">
            <strong>${this.escape(book.title || 'Bez tytu≈Çu')}</strong>
            <div style="font-size:0.9rem;margin-top:0.4rem;opacity:0.8;">
              ${this.words(book.content)} s≈Ç√≥w
            </div>
          </div>
        `).join('');
      }

      renderMapa() {
        document.getElementById('mapa-grid').innerHTML = MAPA.gates.map(gate => `
          <div class="brama-card" onclick="app.insert('${this.escape(gate.name)}')">
            <strong>${gate.name}</strong>
            <div style="font-size:0.9rem;opacity:0.8;margin-top:0.4rem;">${gate.books.length} tytu≈Ç√≥w</div>
          </div>
        `).join('');
      }

      insert(name) {
        if (!this.currentBook) return this.status('Otw√≥rz ksiƒôgƒô');
        const gate = MAPA.gates.find(g => g.name === name);
        const list = gate.books.map(t => `‚Ä¢ ${t}`).join('\n');
        document.getElementById('book-content').value += `\n\n‚Äî \( {name} ‚Äî\n \){list}\n`;
        this.save();
      }

      addBook() {
        const book = { id: Date.now(), title: 'Nowa Ksiƒôga', content: '', created: Date.now() };
        this.books.unshift(book);
        this.saveBooks();
        this.open(book.id);
        this.status('Nowa ksiƒôga utworzona');
      }

      open(id) {
        this.currentBook = this.books.find(b => b.id === id);
        document.getElementById('book-title').value = this.currentBook.title;
        document.getElementById('book-content').value = this.currentBook.content;
        this.renderBooks();
      }

      save() {
        if (!this.currentBook) return;
        this.currentBook.title = document.getElementById('book-title').value;
        this.currentBook.content = document.getElementById('book-content').value;
        this.saveBooks();
      }

      saveBooks() {
        localStorage.setItem(this.BOOKS_KEY, JSON.stringify(this.books));
      }

      analyze() {
        if (!this.currentBook?.content.trim()) return this.status('Brak tekstu');
        const sugs = this.generateSuggestions(this.currentBook.content);
        this.renderSuggestions(sugs);
        this.status(`${sugs.length} sugestii od Bella`);
      }

      generateSuggestions(text) {
        const sugs = [];
        const lower = text.toLowerCase();
        const wordCount = this.words(text);

        if (this.profile === 'amazon') {
          if (!/darmowa|wysy≈Çka|gwarancja|satysfakcja/i.test(lower))
            sugs.push('Dodaj frazy konwertujƒÖce: ‚Äûdarmowa wysy≈Çka‚Äù, ‚Äûgwarancja satysfakcji‚Äù');
          if (!/najlepszy|premium|rewolucyjny|wyjƒÖtkowy/i.test(lower))
            sugs.push('U≈ºyj mocnych przymiotnik√≥w: najlepszy, rewolucyjny, ekskluzywny');
        } else {
          if (!text.includes('‚Äû') && !text.includes('"'))
            sugs.push('Dodaj dialogi ‚Äì zwiƒôkszajƒÖ zaanga≈ºowanie czytelnik√≥w');
          if (!/mi≈Ço≈õƒá|strach|rado≈õƒá|smutek|nadzieja|z≈Ço≈õƒá|przera≈ºenie/i.test(lower))
            sugs.push('Wpleƒá wiƒôcej emocji ‚Äì niech czytelnik poczuje historiƒô');
        }

        if (wordCount < 250) sugs.push('Rozwi≈Ñ tekst ‚Äì d≈Çu≈ºsze fragmenty lepiej siƒô pozycjonujƒÖ');
        if (text.split(/\n\n/).length < 4) sugs.push('Dodaj wiƒôcej akapit√≥w dla lepszej czytelno≈õci');

        return sugs.slice(0, 6);
      }

      renderSuggestions(sugs) {
        const el = document.getElementById('suggestions');
        if (sugs.length === 0) {
          el.innerHTML = '<p style="text-align:center;opacity:0.7;padding:2rem;">Tekst idealny ‚Äì brak sugestii</p>';
          return;
        }
        el.innerHTML = sugs.map(s => `<div class="suggestion">${s}</div>`).join('');
      }

      async export() {
        if (!this.currentBook) return this.status('Brak tre≈õci');
        const { Document, Packer, Paragraph, HeadingLevel } = docx;
        const doc = new Document({
          sections: [{ children: [
            new Paragraph({ text: this.currentBook.title, heading: HeadingLevel.TITLE, alignment: "center" }),
            new Paragraph({ text: new Date().toLocaleDateString('pl-PL'), alignment: "center" }),
            new Paragraph({ text: this.currentBook.content })
          ]}]
        });
        const blob = await Packer.toBlob(doc);
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `${this.currentBook.title.replace(/[^a-z0-9]/gi,'_')}.docx`;
        a.click();
        URL.revokeObjectURL(url);
        this.status('Eksport zako≈Ñczony');
      }

      initSpeech() {
        if (!('webkitSpeechRecognition' in window)) return;
        this.recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        this.recognition.lang = 'pl-PL';
        this.recognition.continuous = true;
        this.recognition.interimResults = true;
        this.recognition.onresult = e => {
          const transcript = Array.from(e.results).map(r => r[0].transcript).join('');
          document.getElementById('book-content').value += transcript;
          this.save();
        };
        this.recognition.onstart = () => {
          document.getElementById('start-dictate').disabled = true;
          document.getElementById('stop-dictate').disabled = false;
        };
        this.recognition.onend = () => {
          document.getElementById('start-dictate').disabled = false;
          document.getElementById('stop-dictate').disabled = true;
        };
      }

      startDictation() { this.recognition?.start(); }
      stopDictation() { this.recognition?.stop(); }

      status(msg) {
        document.getElementById('status').textContent = msg;
        setTimeout(() => document.getElementById('status').textContent = 'Gotowy', 4000);
      }

      words(text = '') { return (text.match(/\b\w+\b/g) || []).length; }
      escape(text) { return text.replace(/</g, '&lt;').replace(/>/g, '&gt;'); }
    }

    const app = new Eterniverse();
    window.app = app;
  </script>
</body>
</html>